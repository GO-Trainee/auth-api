# Техническое задание для разработки сервиса авторизации

## Цель проекта
Создать сервис авторизации на Go для регистрации, аутентификации, управления токенами и предоставления информации о пользователе с использованием PostgreSQL и Redis.

## Требования

### Технологический стек
- **Язык**: Go (последняя стабильная версия)
- **База данных**:
  - PostgreSQL для хранения информации о пользователях
  - Redis для хранения access/refresh токенов и blacklisted токенов
- **Библиотеки и фреймворки**:
  - `gin` или `fiber` для HTTP-сервера
  - `sqlx` или `pgx` для работы с PostgreSQL
  - `go-redis` для работы с Redis
  - `jwt` для генерации и валидации токенов
  - `zap` или `logrus` для логирования
  - `testify` для тестирования
- **Инструменты**:
  - `golang-migrate` для миграций БД
  - Docker для контейнеризации сервиса и зависимостей
  - `godotenv` для управления конфигурацией

### Функциональные требования
1. **Эндпоинты**:
   - **/signup** (POST):
     - Регистрация пользователя.
     - Входные данные: email, пароль, имя.
     - Хеширование пароля (bcrypt).
     - Сохранение в PostgreSQL.
     - Возврат: статус 201, JSON с ID пользователя.
   - **/signin** (POST):
     - Аутентификация пользователя.
     - Входные данные: email, пароль.
     - Проверка пароля, генерация access (JWT, 15 мин) и refresh (Redis, 7 дней) токенов.
     - Возврат: JSON с access токенами.
   - **/refresh** (POST):
     - Обновление access токена по refresh токену.
     - Проверка refresh токена в Redis.
     - Автоматический logout, если refresh токен истёк (удаление из Redis).
     - Возврат: новый access токен или ошибка.
   - **/logout** (POST):
     - Выход пользователя.
     - Добавление access токена в blacklist (Redis, TTL = время жизни токена).
     - Удаление refresh токена из Redis.
     - Возврат: статус 200.
   - **/echo** (GET):
     - Доступно только для авторизованных пользователей.
     - Проверка access токена (включая blacklist).
     - Возврат: JSON с полной информацией о пользователе (ID, email, имя).

### Нефункциональные требования
1. **Логирование**:
   - Использовать `zap` или `logrus`.
   - Логировать все запросы, ошибки и ключевые события (регистрация, вход, выход, обновление токена).
   - Формат: JSON, с полями: timestamp, level, message, context (например, user_id, endpoint).
   - Вывод: stdout

2. **Обработка ошибок**:
   - Единый формат ошибок: JSON `{ "error": "описание" }`.
   - HTTP-коды: 400 (невалидные данные), 401 (неавторизован), 403 (запрещено),404(not found), 500 (внутренняя ошибка).
   - Обработка ошибок базы данных, Redis, JWT.

3. **Тестирование**:
   - Модульные тесты для бизнес-логики (хеширование, генерация токенов and etc.).
   - Тесты для обработки ошибок (невалидные токены, истёкшие токены, неверные пароли and etc).

4. **Миграции**:
   - Использовать `golang-migrate` or `goose`.
   - Миграции для создания таблицы `users`.
   - Поддержка отката (down миграции).
